# 额外选项集成功能使用示例

## 功能说明
现在所有主节点（Qwen3VL_Advanced 和 Qwen3VL_Chat）都支持连接"Qwen3VL额外选项"节点，实现更灵活的提示词增强。

## 节点连接示例

### 示例1：基础图像打标 + 额外选项

```
┌─────────────────────────┐
│  Qwen3VL额外选项节点     │
│  ✓ 包含光照信息          │
│  ✓ 包含相机角度          │
│  ✓ 包含艺术质量          │
└────────┬────────────────┘
         │ (输出: QWEN3VL_EXTRA_OPTIONS)
         │
         ↓
┌────────┴────────────────┐
│  Qwen3VL主节点           │
│  预设提示词: 详细        │
│  🎯 Qwen3VL额外选项 ← 连接│
└─────────────────────────┘
```

**效果**：
- 基础提示词会自动增强
- 生成的描述会包含光照、角度和艺术质量信息
- 无需手动修改提示词

---

### 示例2：智能对话 + 额外选项

```
┌─────────────────────────┐
│  Qwen3VL额外选项节点     │
│  ✓ 包含相机详情          │
│  ✓ 包含构图信息          │
│  ✓ 不使用模糊语言        │
└────────┬────────────────┘
         │
         ↓
┌────────┴────────────────┐
│  Qwen3VL智能对话节点     │
│  系统角色: 摄影分析助手  │
│  🎯 Qwen3VL额外选项 ← 连接│
└─────────────────────────┘
```

**效果**：
- AI助手会以专业摄影师的角度分析图像
- 自动包含相机参数和构图分析
- 使用精确的专业术语

---

### 示例3：批量打标（已有功能）

```
┌─────────────────────────┐
│  Qwen3VL额外选项节点     │
│  ✓ 排除性感内容          │
│  ✓ 不提及文字            │
│  ✓ 描述重要元素          │
└────────┬────────────────┘
         │
         ↓
┌────────┴────────────────┐
│  Qwen3VL批量打标节点     │
│  输入文件夹: ./images    │
│  🎯 Qwen3VL额外选项 ← 连接│
└─────────────────────────┘
```

**效果**：
- 批量处理时应用统一的额外选项
- 所有图片的描述都遵循相同的规则
- 适合大规模数据集处理

---

### 示例4：多节点共享额外选项

```
                    ┌─────────────────────────┐
                    │  Qwen3VL额外选项节点     │
                    │  ✓ 包含光照信息          │
                    │  ✓ 包含艺术质量          │
                    └────────┬────────────────┘
                             │
                ┌────────────┼────────────┐
                │            │            │
                ↓            ↓            ↓
        ┌───────────┐ ┌───────────┐ ┌───────────┐
        │ 主节点1   │ │ 主节点2   │ │ 主节点3   │
        │ 图像1     │ │ 图像2     │ │ 图像3     │
        └───────────┘ └───────────┘ └───────────┘
```

**优势**：
- 一次配置，多处使用
- 保持所有节点的一致性
- 便于批量调整

---

## 使用步骤

### 步骤1：添加额外选项节点
1. 在ComfyUI中右键 → 添加节点
2. 选择：`🍭大炮-Qwen3VL` → `🍭大炮-Qwen3VL额外选项`
3. 配置需要的选项（勾选相应的复选框）

### 步骤2：连接到主节点
1. 找到主节点的 `🎯 Qwen3VL额外选项` 输入端口
2. 从额外选项节点的输出端口连接过来
3. 连接成功后会显示连线

### 步骤3：正常使用
1. 在主节点中选择预设提示词或输入自定义提示词
2. 运行工作流
3. 额外选项会自动应用，无需手动操作

---

## 提示词增强效果示例

### 原始提示词
```
详细描述这张图片
```

### 启用额外选项后
```
详细描述这张图片

请遵循以下额外要求：
- 请描述图像的光照情况。
- 请描述相机角度信息。
- 请评价图像的美学/艺术质量（从非常低到非常高）。
- 请描述图像构图信息，如三分法、引导线、对称性等。
```

---

## 常见问题

### Q1: 不连接额外选项会怎样？
**A**: 完全不影响，节点会按原来的方式工作。额外选项是可选的。

### Q2: 可以同时使用预设提示词和额外选项吗？
**A**: 可以！额外选项会应用到任何提示词上，包括预设提示词和自定义提示词。

### Q3: 批量打标节点也支持吗？
**A**: 批量打标节点已经有这个功能了，现在主节点也支持了。

### Q4: 额外选项会覆盖我的提示词吗？
**A**: 不会！额外选项是追加到你的提示词后面，不会覆盖原有内容。

### Q5: 可以一个额外选项节点连接多个主节点吗？
**A**: 可以！这样可以保持多个节点的一致性。

---

## 最佳实践

### 1. 图像打标场景
推荐启用的选项：
- ✓ 包含光照信息
- ✓ 包含相机角度
- ✓ 包含艺术质量
- ✓ 包含构图信息

### 2. 内容审核场景
推荐启用的选项：
- ✓ 排除性感内容
- ✓ 包含安全性
- ✓ 不使用模糊语言

### 3. 专业摄影分析
推荐启用的选项：
- ✓ 包含相机详情
- ✓ 包含光照信息
- ✓ 提及光源
- ✓ 包含景深信息

### 4. 简洁描述场景
推荐启用的选项：
- ✓ 描述重要元素
- ✓ 不提及文字
- ✓ 不提及分辨率
- ✓ 不使用模糊语言

---

## 技术细节

### 额外选项数据类型
```python
QWEN3VL_EXTRA_OPTIONS = {
    "包含人物信息": bool,
    "排除不可改变特征": bool,
    "包含光照信息": bool,
    # ... 更多选项
}
```

### 提示词增强函数
```python
def build_enhanced_prompt(base_prompt: str, options: dict) -> str:
    """
    根据额外选项构建增强的提示词
    
    Args:
        base_prompt: 基础提示词
        options: 额外选项字典
        
    Returns:
        增强后的提示词
    """
    # 自动生成额外要求
    # 追加到基础提示词后面
    # 返回完整的增强提示词
```

---

## 更新日志

### 2024-11-18
- ✅ 在 Qwen3VL_Advanced 节点添加额外选项支持
- ✅ 在 Qwen3VL_Chat 节点添加额外选项支持
- ✅ 实现自动提示词增强功能
- ✅ 保持向后兼容性

---

## 总结

额外选项集成功能让你可以：
- 🎯 更灵活地控制生成内容
- 🔧 模块化配置，便于管理
- 🚀 提高工作效率
- 🔄 保持一致性
- ✅ 无缝集成，不影响现有工作流

立即尝试这个新功能，让你的图像描述更加专业和精确！
